<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploring Fortran in Nutrition Science 🧪📊</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="10.9_fortran_files/libs/clipboard/clipboard.min.js"></script>
<script src="10.9_fortran_files/libs/quarto-html/quarto.js"></script>
<script src="10.9_fortran_files/libs/quarto-html/popper.min.js"></script>
<script src="10.9_fortran_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="10.9_fortran_files/libs/quarto-html/anchor.min.js"></script>
<link href="10.9_fortran_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="10.9_fortran_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="10.9_fortran_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="10.9_fortran_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="10.9_fortran_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#how-to-download-and-run-this-notebook" id="toc-how-to-download-and-run-this-notebook" class="nav-link active" data-scroll-target="#how-to-download-and-run-this-notebook">How to Download and Run This Notebook 📥</a></li>
  <li><a href="#step-1-a-brief-history-of-fortran-in-scientific-computing" id="toc-step-1-a-brief-history-of-fortran-in-scientific-computing" class="nav-link" data-scroll-target="#step-1-a-brief-history-of-fortran-in-scientific-computing">Step 1: A Brief History of Fortran in Scientific Computing 🕰️</a></li>
  <li><a href="#step-2-define-the-problem---calculating-a-nutritional-index" id="toc-step-2-define-the-problem---calculating-a-nutritional-index" class="nav-link" data-scroll-target="#step-2-define-the-problem---calculating-a-nutritional-index">Step 2: Define the Problem - Calculating a Nutritional Index 🍬🥛</a></li>
  <li><a href="#step-3-create-the-dataset" id="toc-step-3-create-the-dataset" class="nav-link" data-scroll-target="#step-3-create-the-dataset">Step 3: Create the Dataset 📋</a></li>
  <li><a href="#step-4-write-the-fortran-program" id="toc-step-4-write-the-fortran-program" class="nav-link" data-scroll-target="#step-4-write-the-fortran-program">Step 4: Write the Fortran Program 🖥️</a></li>
  <li><a href="#step-5-compile-and-run-the-fortran-program" id="toc-step-5-compile-and-run-the-fortran-program" class="nav-link" data-scroll-target="#step-5-compile-and-run-the-fortran-program">Step 5: Compile and Run the Fortran Program ⚙️</a></li>
  <li><a href="#step-6-load-and-visualise-the-results" id="toc-step-6-load-and-visualise-the-results" class="nav-link" data-scroll-target="#step-6-load-and-visualise-the-results">Step 6: Load and Visualise the Results 📈</a></li>
  <li><a href="#step-7-learning-points-and-next-steps" id="toc-step-7-learning-points-and-next-steps" class="nav-link" data-scroll-target="#step-7-learning-points-and-next-steps">Step 7: Learning Points and Next Steps 🎓</a>
  <ul class="collapse">
  <li><a href="#learning-points" id="toc-learning-points" class="nav-link" data-scroll-target="#learning-points">Learning Points</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  <li><a href="#setup-requirements" id="toc-setup-requirements" class="nav-link" data-scroll-target="#setup-requirements">Setup Requirements</a></li>
  <li><a href="#expected-output" id="toc-expected-output" class="nav-link" data-scroll-target="#expected-output">Expected Output</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploring Fortran in Nutrition Science 🧪📊</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Welcome to this fun mini-project where we take a step back in time and explore <strong>Fortran</strong>, a programming language that has played a significant role in scientific computing since the 1950s! Fortran (short for <em>Formula Translation</em>) was widely used in early nutrition and epidemiological research for simulations, statistical modeling, and numerical computations. In this notebook, we’ll use Fortran to calculate a simple nutritional index based on dietary intakes, bringing a bit of historical flair to our modern data science toolkit.</p>
<p>We’ll: - <strong>Learn about Fortran’s role</strong> in scientific computing history 🕰️ - <strong>Calculate a nutritional index</strong> using sugar and SFA intake data 🍬🥛 - <strong>Run Fortran code</strong> externally and display the results in this notebook 📈</p>
<p>Let’s have some fun and see what Fortran can do in nutrition science!</p>
<section id="how-to-download-and-run-this-notebook" class="level2">
<h2 class="anchored" data-anchor-id="how-to-download-and-run-this-notebook">How to Download and Run This Notebook 📥</h2>
<p>To make this notebook easy to use, here’s how you can download and run it, along with the Fortran code:</p>
<ol type="1">
<li><strong>Download the Notebook</strong>:
<ul>
<li>If you’re viewing this on a platform like GitHub or a rendered HTML page, you can download the raw <code>.ipynb</code> file by clicking the ‘Raw’ button or ‘Download’ link (if available).</li>
<li>Alternatively, copy the JSON content of this notebook (provided in the <code>&lt;xaiArtifact/&gt;</code> tag with artifact ID <code>d4e5f6g7-h8i9-40j1-k2l3-m4n5o6p7q8r9</code>) and save it as <code>10.9_fortran_nutrition.ipynb</code>.</li>
<li>To save manually: Copy the JSON content, paste it into a text editor, and save the file with a <code>.ipynb</code> extension (e.g., <code>10.9_fortran_nutrition.ipynb</code>).</li>
</ul></li>
<li><strong>Download the Fortran Code</strong>:
<ul>
<li>In Step 4, you’ll find the Fortran code (<code>nutrition_index.f90</code>) embedded in a Markdown cell. Copy the code block, paste it into a text editor, and save it as <code>nutrition_index.f90</code> in the same directory as this notebook.</li>
</ul></li>
<li><strong>Run the Notebook</strong>:
<ul>
<li><p>Open Jupyter Notebook in your environment:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/Documents/data-analysis-toolkit-FNS/venv/bin/activate</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> notebook</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Open <code>10.9_fortran_nutrition.ipynb</code> and follow the steps to run the cells.</p></li>
</ul></li>
</ol>
<p>Let’s get started with the analysis!</p>
</section>
<section id="step-1-a-brief-history-of-fortran-in-scientific-computing" class="level2">
<h2 class="anchored" data-anchor-id="step-1-a-brief-history-of-fortran-in-scientific-computing">Step 1: A Brief History of Fortran in Scientific Computing 🕰️</h2>
<p>Fortran was developed by IBM in the 1950s and became the go-to language for scientific and engineering applications due to its efficiency in numerical computations. In nutrition science, Fortran was used for early computational models, such as simulating metabolic processes, analysing dietary surveys, and performing statistical analyses like ANOVA or regression.</p>
<p>While Python has largely replaced Fortran in modern data science, Fortran is still used in high-performance computing (e.g., climate modelling, computational chemistry) because of its speed and ability to handle complex mathematical operations. Today, we’ll use Fortran to calculate a simple nutritional index, giving us a taste of its capabilities!</p>
</section>
<section id="step-2-define-the-problem---calculating-a-nutritional-index" class="level2">
<h2 class="anchored" data-anchor-id="step-2-define-the-problem---calculating-a-nutritional-index">Step 2: Define the Problem - Calculating a Nutritional Index 🍬🥛</h2>
<p>Let’s define a simple task: calculating a nutritional index based on sugar and SFA (saturated fatty acid) intake. We’ll use a small dataset of 5 participants with their daily sugar and SFA intakes (in grams). The index will be a weighted score:</p>
<ul>
<li>Nutritional Index = (Sugar Intake × 0.4) + (SFA Intake × 0.6)</li>
<li>Lower scores indicate healthier diets (less sugar and SFA).</li>
</ul>
<p>We’ll write a Fortran program to read the intake data, compute the index for each participant, and save the results to a file. Then, we’ll load the results into this notebook for visualisation.</p>
</section>
<section id="step-3-create-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="step-3-create-the-dataset">Step 3: Create the Dataset 📋</h2>
<p>First, let’s create a small dataset of sugar and SFA intakes for 5 participants and save it to a file (<code>intakes.txt</code>) that our Fortran program can read.</p>
<div id="cell-6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a small dataset</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Participant'</span>: [<span class="st">'P1'</span>, <span class="st">'P2'</span>, <span class="st">'P3'</span>, <span class="st">'P4'</span>, <span class="st">'P5'</span>],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sugar_Intake'</span>: [<span class="dv">40</span>, <span class="dv">55</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">25</span>],  <span class="co"># grams/day</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SFA_Intake'</span>: [<span class="dv">20</span>, <span class="dv">35</span>, <span class="dv">15</span>, <span class="dv">40</span>, <span class="dv">10</span>]     <span class="co"># grams/day</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data to a text file (space-separated)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">'Sugar_Intake'</span>, <span class="st">'SFA_Intake'</span>]].to_csv(<span class="st">'intakes.txt'</span>, sep<span class="op">=</span><span class="st">' '</span>, index<span class="op">=</span><span class="va">False</span>, header<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the dataset</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dataset of Intakes:"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset of Intakes:
  Participant  Sugar_Intake  SFA_Intake
0          P1            40          20
1          P2            55          35
2          P3            30          15
3          P4            60          40
4          P5            25          10</code></pre>
</div>
</div>
</section>
<section id="step-4-write-the-fortran-program" class="level2">
<h2 class="anchored" data-anchor-id="step-4-write-the-fortran-program">Step 4: Write the Fortran Program 🖥️</h2>
<p>Below is the Fortran program (<code>nutrition_index.f90</code>) that reads the intake data, calculates the nutritional index for each participant, and saves the results to a file (<code>index_scores.txt</code>).</p>
<p>Copy the code below into a file named <code>nutrition_index.f90</code> in the same directory as this notebook:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode fortran code-with-copy"><code class="sourceCode fortranfixed"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> nutrition_index</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">implicit</span> <span class="kw">none</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">integer</span>, <span class="dt">parameter</span> <span class="dt">::</span> n <span class="kw">=</span> <span class="dv">5</span>  <span class="co">! Number of participants</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> <span class="dt">::</span> sugar(n), sfa(n), <span class="bu">index</span>(n)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">integer</span> <span class="dt">::</span> i</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">! Open the input file</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">open(unit</span><span class="kw">=</span><span class="dv">10</span>, <span class="fu">file</span><span class="kw">=</span><span class="st">'intakes.txt'</span>, <span class="fu">status</span><span class="kw">=</span><span class="st">'old'</span><span class="fu">)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">! Read sugar and SFA intakes</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">do</span> i <span class="kw">=</span> <span class="dv">1</span>, n</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read(</span><span class="dv">10</span>, <span class="fu">*)</span> sugar(i), sfa(i)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end do</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close(</span><span class="dv">10</span><span class="fu">)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">! Calculate the nutritional index</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">do</span> i <span class="kw">=</span> <span class="dv">1</span>, n</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">index</span>(i) <span class="kw">=</span> (sugar(i) <span class="kw">*</span> <span class="fl">0.4</span>) <span class="kw">+</span> (sfa(i) <span class="kw">*</span> <span class="fl">0.6</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end do</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">! Save the results to a file</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">open(unit</span><span class="kw">=</span><span class="dv">20</span>, <span class="fu">file</span><span class="kw">=</span><span class="st">'index_scores.txt'</span>, <span class="fu">status</span><span class="kw">=</span><span class="st">'replace'</span><span class="fu">)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">do</span> i <span class="kw">=</span> <span class="dv">1</span>, n</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write(</span><span class="dv">20</span>, <span class="fu">*)</span> <span class="bu">index</span>(i)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end do</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close(</span><span class="dv">20</span><span class="fu">)</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="kw">*</span>, <span class="st">'Nutritional index scores saved to index_scores.txt'</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="kw">end program</span> nutrition_index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-compile-and-run-the-fortran-program" class="level2">
<h2 class="anchored" data-anchor-id="step-5-compile-and-run-the-fortran-program">Step 5: Compile and Run the Fortran Program ⚙️</h2>
<p>To run the Fortran program, you’ll need a Fortran compiler like <code>gfortran</code>. If you don’t have <code>gfortran</code> installed, you can install it on macOS using Homebrew:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install gcc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, compile and run the program:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gfortran</span> <span class="at">-o</span> nutrition_index nutrition_index.f90</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./nutrition_index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will read <code>intakes.txt</code>, calculate the nutritional index scores, and save them to <code>index_scores.txt</code>. Let’s run this command in the notebook using Python’s <code>subprocess</code> module.</p>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the Fortran program</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    subprocess.run([<span class="st">'gfortran'</span>, <span class="st">'-o'</span>, <span class="st">'nutrition_index'</span>, <span class="st">'nutrition_index.f90'</span>], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Fortran program compiled successfully."</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> subprocess.CalledProcessError:</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: Failed to compile the Fortran program. Ensure gfortran is installed and nutrition_index.f90 exists."</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Fortran program</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    subprocess.run([<span class="st">'./nutrition_index'</span>], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Fortran program executed successfully."</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> subprocess.CalledProcessError:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: Failed to run the Fortran program. Ensure it compiled correctly."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-6-load-and-visualise-the-results" class="level2">
<h2 class="anchored" data-anchor-id="step-6-load-and-visualise-the-results">Step 6: Load and Visualise the Results 📈</h2>
<p>The Fortran program saved the nutritional index scores to <code>index_scores.txt</code>. Let’s load the results into the notebook and visualise them alongside the original intake data.</p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the index scores</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>index_scores <span class="op">=</span> pd.read_csv(<span class="st">'index_scores.txt'</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">'Nutritional_Index'</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with the original data</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Nutritional_Index'</span>] <span class="op">=</span> index_scores</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Results with Nutritional Index:"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise the nutritional index</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'Nutritional_Index'</span>, y<span class="op">=</span><span class="st">'Participant'</span>, data<span class="op">=</span>data)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Nutritional Index Scores by Participant 📊'</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Nutritional Index (Lower = Healthier)'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Participant'</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-7-learning-points-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="step-7-learning-points-and-next-steps">Step 7: Learning Points and Next Steps 🎓</h2>
<section id="learning-points" class="level3">
<h3 class="anchored" data-anchor-id="learning-points">Learning Points</h3>
<ul>
<li><strong>Fortran’s Legacy</strong>: Fortran has a rich history in scientific computing, particularly in nutrition and epidemiology, where it was used for early computational models. It’s still valued for its performance in numerical tasks.</li>
<li><strong>Numerical Computation</strong>: We used Fortran to perform a simple calculation (nutritional index), showcasing its ability to handle numerical data efficiently.</li>
<li><strong>Integration with Modern Tools</strong>: By running Fortran externally and loading the results into Python, we combined the strengths of both languages—Fortran’s computational speed and Python’s visualisation capabilities.</li>
<li><strong>Fun Exploration</strong>: Exploring Fortran adds a unique and enjoyable element to our mini-projects, bridging the past and present of scientific computing.</li>
</ul>
</section>
<section id="next-steps" class="level3">
<h3 class="anchored" data-anchor-id="next-steps">Next Steps</h3>
<ul>
<li><p><strong>More Complex Fortran Models</strong>: Try using Fortran for more advanced nutrition science tasks, such as simulating dietary intake over time or solving differential equations for metabolic models.</p></li>
<li><p><strong>Fortran in Jupyter</strong>: Explore the <code>fortran-magic</code> package to run Fortran code directly in Jupyter Notebook cells:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install fortran-magic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then load the extension in a notebook cell:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext fortranmagic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Compare with Python</strong>: Rewrite the nutritional index calculation in Python and compare the results and performance with Fortran.</p></li>
<li><p><strong>Historical Context</strong>: Research historical nutrition studies that used Fortran to add more context to your project.</p></li>
</ul>
<p><em>Keep having fun exploring computational methods in nutrition science! 🥕📉</em></p>
<hr>
</section>
<section id="setup-requirements" class="level3">
<h3 class="anchored" data-anchor-id="setup-requirements">Setup Requirements</h3>
<ol type="1">
<li><p><strong>Install Libraries</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/Documents/data-analysis-toolkit-FNS/venv/bin/activate</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pandas==2.2.3 matplotlib==3.9.2 seaborn==0.13.2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Install a Fortran Compiler</strong>:</p>
<ul>
<li><p>On macOS, install <code>gfortran</code> via Homebrew:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install gcc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>On Linux, install <code>gfortran</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install gfortran</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>On Windows, install <code>gfortran</code> via MinGW or WSL.</p></li>
</ul></li>
<li><p><strong>Environment</strong>: Python 3.9, compatible with Apple Silicon (MPS).</p></li>
<li><p><strong>Fortran File</strong>: Ensure <code>nutrition_index.f90</code> is saved in the same directory as this notebook.</p></li>
</ol>
</section>
<section id="expected-output" class="level3">
<h3 class="anchored" data-anchor-id="expected-output">Expected Output</h3>
<ul>
<li><strong>Dataset Table</strong>: A small table showing sugar and SFA intakes for 5 participants.</li>
<li><strong>Fortran Output</strong>: Nutritional index scores saved to <code>index_scores.txt</code> and displayed in the notebook.</li>
<li><strong>Bar Plot</strong>: A visualisation of the nutritional index scores by participant.</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>